name: fedora-kde-2025
on:
  workflow_dispatch:
jobs:
  fedora-rdp:
    runs-on: ubuntu-latest
    timeout-minutes: 99999

    steps:
      - name: Download Fedora 43 KDE Live ISO
        run: |
          # ØªØ­Ù…ÙŠÙ„ Fedora 43 KDE - Ø£Ø­Ø¯Ø« Ø¥ØµØ¯Ø§Ø± 2025
          wget https://download.fedoraproject.org/pub/fedora/linux/releases/43/KDE/x86_64/iso/Fedora-KDE-Desktop-Live-43-1.6.x86_64.iso -O fedora-kde.iso
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø±Øµ Ø§ÙØªØ±Ø§Ø¶ÙŠ
          qemu-img create -f qcow2 fedora-disk.qcow2 60G
          echo "âœ… Fedora 43 KDE downloaded successfully!"

      - name: Start Fedora 43 KDE VM with 16GB RAM
        run: |
          # ØªØ´ØºÙŠÙ„ Fedora 43 KDE Live Ù…Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©
          nohup qemu-system-x86_64 \
            -accel kvm \
            -cpu host \
            -m 16G \          # ğŸ¯ 16GB Ø±Ø§Ù…
            -smp 8 \           # ğŸ¯ 8 Ù…Ø¹Ø§Ù„Ø¬Ø§Øª
            -cdrom fedora-kde.iso \
            -drive file=fedora-disk.qcow2,format=qcow2 \
            -netdev user,id=net0,hostfwd=tcp::3389-:3389,hostfwd=tcp::2222-:22,hostfwd=tcp::8080-:8080 \
            -device virtio-net-pci,netdev=net0 \
            -vga virtio \
            -display none \
            -daemonize &

          echo "ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Fedora 43 KDE Live..."
          sleep 90

      - name: Install XRDP on Fedora KDE
        run: |
          # Ù†Ù†ØªØ­Øµ Ø­ØªÙ‰ ÙŠÙƒÙˆÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²Ø§Ù‹ Ø«Ù… Ù†Ø«Ø¨Øª XRDP
          sudo apt-get install -y sshpass
          
          # Ù†Ø³ØªØ®Ø¯Ù… SSH Ù„ØªØ«Ø¨ÙŠØª XRDP Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙŠ
          sshpass -p '' ssh -o StrictHostKeyChecking=no -p 2222 liveuser@localhost << 'EOF'
            # ØªØµØ±ÙŠØ­ sudo
            echo 'liveuser ALL=(ALL) NOPASSWD:ALL' | sudo tee -a /etc/sudoers
            
            # ØªØ«Ø¨ÙŠØª XRDP ÙˆØ¨ÙŠØ¦Ø© KDE ÙƒØ§Ù…Ù„Ø©
            sudo dnf update -y
            sudo dnf install -y xrdp kde-desktop firefox chromium
            sudo systemctl enable xrdp
            sudo systemctl start xrdp
            
            # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø¦Ù…
            sudo useradd -m -G wheel -s /bin/bash fedora43
            echo "fedora43:Fedora43@2025!" | sudo chpasswd
            
            # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯Ø§Ø± Ø§Ù„Ù†Ø§Ø±ÙŠ
            sudo firewall-cmd --add-port=3389/tcp --permanent
            sudo firewall-cmd --add-port=22/tcp --permanent
            sudo firewall-cmd --reload
            
            # ØªØ«Ø¨ÙŠØª Ø¨Ø±Ø§Ù…Ø¬ Ø¥Ø¶Ø§ÙÙŠØ©
            sudo dnf install -y git curl wget vim nano
            sudo dnf install -y gcc-c++ make python3-pip nodejs npm
            
            echo "âœ… Fedora 43 KDE with XRDP configured!"
          EOF

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=fedora43-kde-${{ github.run_id }}

      - name: Get Connection Info
        run: |
          TS_IP=$(tailscale ip -4)
          echo "TAILSCALE_IP=$TS_IP" >> $env:GITHUB_ENV
          echo "ğŸ¯ Fedora 43 KDE 2025 Ready!"
          echo "ğŸ“ RDP Address: $TS_IP:3389"
          echo "ğŸ‘¤ Username: fedora43"
          echo "ğŸ”‘ Password: Fedora43@2025!"
          echo "ğŸ’¾ RAM: 16GB"
          echo "âš¡ CPU: 8 Cores"
          echo "ğŸ’½ Storage: 60GB"
          echo "ğŸ¨ Desktop: KDE Plasma"
          echo "ğŸ–¥ï¸ Version: Fedora 43 (2025 Latest)"

      - name: KDE Desktop Monitor
        run: |
          counter=1
          while true; do
            echo "ğŸŒŸ [$counter] Fedora 43 KDE Active - $(date +'%Y-%m-%d %H:%M:%S')"
            echo "ğŸ“ Connect: ${{ env.TAILSCALE_IP }}:3389"
            echo "ğŸ‘¤ User: fedora43"
            echo "ğŸ”‘ Pass: Fedora43@2025!"
            echo "ğŸ¨ Desktop: KDE Plasma"
            echo "ğŸ’¾ RAM: 16GB | âš¡ CPU: 8 Cores"
            echo "â° Uptime: $((counter * 5)) minutes"
            echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
            sleep 300
            counter=$((counter + 1))
          done
